#!/bin/sh
#MISE description="Generate shell completion scripts"

set -e

# Ensure output directory exists
mkdir -p completions

echo "Generating usage spec..."
cargo build -p morphir --quiet

# Generate usage spec
./target/debug/morphir usage >docs/morphir.usage.kdl

# Generate completions using usage CLI
if command -v usage >/dev/null 2>&1; then
    echo "Generating shell completions..."
    usage generate completion bash morphir --file docs/morphir.usage.kdl >completions/morphir.bash
    usage generate completion zsh morphir --file docs/morphir.usage.kdl >completions/_morphir
    usage generate completion fish morphir --file docs/morphir.usage.kdl >completions/morphir.fish
    echo "Shell completions generated in completions/"
else
    echo "Warning: 'usage' CLI not found. Install with: mise install"
    echo "Usage spec saved to docs/morphir.usage.kdl"
    exit 1
fi
